<html>

<head>
<meta charset="UTF-8">
<script src="cjk_by_ids.js"></script>
<style>
section#txt {
    display: -webkit-inline-box;
}
section#components{
font-family: SimSun;
width: 50%;
}
section#chars {
    font-family: SimSun;
    width: 49%;
    margin-left: 1%;
}

section#chars > blockquote , a{
margin-block-start: 3px;
    margin-block-end: 4px;
    margin-inline-start: 4px;
    margin-inline-end: 1px;
    background: white;
    width: max-content;
    font-size: 4ch;
}
section#chars > blockquote.char,  section#components > a.cmp{
    display: inline-flex !important;
}
section#components > a.cmp_svg{
    display: inline !important;
}
section#components > a.rad, section#chars > blockquote.rad{
    background: red !important;
    display: inline-flex !important;
}
section#components > a.rad_svg, section#chars > blockquote.rad_svg{
    background: red !important;
    display: inline !important;
}
h1{
text-align: center;
}
</style>
<title>CJK By IDS</title>
</head>
	
<body>
<h1>CJK By IDS</h1>
<select id="order" style="background-color: buttonface;" title="Sort by"></select>
<button id="clear_er" style="background-color: buttonface;">Clear all selections</button>
<section id="txt"><br>
<section id="components" style="background-color: buttonface;"></section>
<section id="chars" style="background-color: buttonface;"></section>
</section>
<br>
<script>
let srt=["Sort by frequency", "Sort by stroke count"];
var slc=document.getElementById("order");
var cmp=document.getElementById("components");
var chs=document.getElementById("chars");
var clr=document.getElementById("clear_er");
var fond=[];
var fond_i=0;
var wInterval;
var svg_scl=0.75;

function absBoundingClientRect(el){
	let st = [window?.scrollY,
					window?.pageYOffset,
					el?.ownerDocument?.documentElement?.scrollTop,
					document?.documentElement?.scrollTop,
					document?.body?.parentNode?.scrollTop,
					document?.body?.scrollTop,
					document?.head?.scrollTop];
					
		let sl = [window?.scrollX,
						window?.pageXOffset,
						el?.ownerDocument?.documentElement?.scrollLeft,
						document?.documentElement?.scrollLeft,
						document?.body?.parentNode?.scrollLeft,
						document?.body?.scrollLeft,
						document?.head?.scrollLeft];
						
				let scrollTop=0;
				for(let k=0; k<st.length; k++){
					if(!!st[k] && typeof  st[k] !=='undefined' && st[k]>0){
						scrollTop=(st[k]>scrollTop)?st[k]:scrollTop;
					}
				}			

				let scrollLeft=0;
				for(let k=0; k<sl.length; k++){
					if(!!sl[k] && typeof  sl[k] !=='undefined' && sl[k]>0){
						scrollLeft=(sl[k]>scrollLeft)?sl[k]:scrollLeft;
					}
				}
	
	const rct=el.getBoundingClientRect();
	let r={};

	r.left=rct.left+scrollLeft;
	r.right=rct.right+scrollLeft;
	r.top=rct.top+scrollTop;
	r.bottom=rct.bottom+scrollTop;
	r.height=rct.height;
	r.width=rct.width;
	
	return r;
}

function getClientBoundingMiddles(r){
	return {v: 0.5*r.height+r.top, h: 0.5*r.width+r.left};
}

function writeFound() {
	try{
		chars.innerHTML+='<blockquote class="char" title="'+fond[fond_i][0]+'">'+fond[fond_i][1]+'</blockquote>';
		fond_i++;
	}catch(e){;}

}
function stopWriteFound() {
	clearInterval(wInterval);
	fond=[];
	fond_i=0;
}

srt.forEach(s => {
    let option = document.createElement('option');
    option.textContent = s;
    slc.appendChild(option);	
});

function drawCmp(){
let arr=(slc.selectedIndex==0)?smp_components_byFreq:smp_components_bySc;
cmp.innerHTML='';
for(let i=0; len_i=arr.length, i<len_i; i++){
		let lk=document.createElement('a');
		lk.setAttribute("Hex",arr[i][0]);
		lk.title=arr[i][0]+' (Stroke count: '+arr[i][3]+')';
		let ud=svgs.filter((s)=>{return s[0]==arr[i][0];});
		let t=String.fromCodePoint(arr[i][0]);
		lk.innerHTML=t;
		if(ud.length>0){
		cmp.appendChild(lk);
		let lrct=absBoundingClientRect(lk);
		let w=lrct.width;
		let h=lrct.width;
		let b=lrct.bottom;
				lk.innerHTML='<div style="color: transparent !important; pointer-events: none !important; padding: 0px !important; border-bottom-width: 0px !important; border-left-width: 0px !important; border-right-width: 0px !important; border-top-width: 0px!important; margin-block-start: 3px!important; margin-block-end: 4px!important; max-width: max-content !important; display: inline-grid !important;">'+t+'<svg style="pointer-events: none !important; user-select: none !important;"><g style="pointer-events: none !important; "><path style="pointer-events: none !important; transform: scale(0.01); transform-origin: left center"; d="'+ud[0][1]+ '"/></g></svg></div>';
					let v=[...lk.children][0].children[0];
					v.style.width=w;
					v.style.height=h;
				lrct=absBoundingClientRect(lk);
				lk.style.transform="translateY("+(b-lrct.bottom)+"px)"
				v.style.transform="scaleY(-1)";
				v.style.transformOrigin="center";
				let dv=[...lk.children][0];
					dv.style.width=w;
					dv.style.height=h;
				let s=[...v.getElementsByTagName('path')][0];
				let svg_rct=absBoundingClientRect(s);
				let m=Math.max(svg_rct.width,svg_rct.height);
				let m2=Math.max(w,h);
				let scl=(m2/m)*svg_scl;
				let l_m=getClientBoundingMiddles(lrct);
				let s_m=getClientBoundingMiddles(svg_rct);
				dv.style.transform="scale("+scl+") translate("+(l_m.h-s_m.h)+"px, "+(l_m.v-s_m.v)+"px)";
				dv.style.verticalAlign='text-bottom';
				lk.className='cmp_svg';
		}else{
			cmp.appendChild(lk);
			lk.className='cmp';
		}
	}
	
	let lnk=[...cmp.getElementsByTagName('a')];
	lnk.forEach((lk)=>{
			lk.onclick=()=>{
			stopWriteFound();
			if(lk.className==='rad'){
				lk.className='cmp';
			}else if(lk.className==='rad_svg'){
				lk.className='cmp_svg';
			}else if(lk.className==='cmp_svg'){
				lk.className='rad_svg';
			}else if(lk.className==='cmp'){
				lk.className='rad';
			}
			let rd=[...cmp.querySelectorAll('a.rad'), ...cmp.querySelectorAll('a.rad_svg')];
			
			chars.innerHTML='';
			if(rd.length>0){
				drawChars(rd);
			}
		};
});
}

function drawChars(rd){
				var incl=[];
				rd.forEach((d)=>{
					
					let r=document.createElement('blockquote');
					
		let t=String.fromCodePoint(d.getAttribute("Hex"));			
		let ud=svgs.filter((s)=>{return s[0]==d.getAttribute("Hex");});
		
					incl.push(t);
					r.innerHTML=t;
		if(ud.length>0){
		chars.appendChild(r);
		let lrct=absBoundingClientRect(r);
		let w=lrct.width;
		let h=lrct.width;
		let b=lrct.bottom;
				r.innerHTML='<div style="color: transparent !important; pointer-events: none !important; padding: 0px !important; border-bottom-width: 0px !important; border-left-width: 0px !important; border-right-width: 0px !important; border-top-width: 0px!important; margin-block-start: 3px!important; margin-block-end: 4px!important; max-width: max-content !important; display: inline-grid !important; vertical-align: top !important;">'+t+'<svg style="pointer-events: none !important; user-select: none !important;"><g style="pointer-events: none !important;"><path style="pointer-events: none !important; transform: scale(0.01); transform-origin: left center"; d="'+ud[0][1]+ '"/></g></svg></div>';
					let v=[...r.children][0].children[0];
					v.style.width=w;
					v.style.height=h;
				let svg_rct=absBoundingClientRect(v);
					v.style.transform="scaleY(-1) translateY("+(svg_rct.top-lrct.top)+"px)";
					v.style.transformOrigin="center";
				let dv=[...r.children][0];
					dv.style.width=w;
					dv.style.height=h;
				let s=[...v.getElementsByTagName('path')][0];
				 svg_rct=absBoundingClientRect(s);
				let m=Math.max(svg_rct.width,svg_rct.height);
				let m2=Math.max(w,h);
				let scl=(m2/m)*svg_scl;
				let l_m=getClientBoundingMiddles(lrct);
				let s_m=getClientBoundingMiddles(svg_rct);
				dv.style.transform="scale("+scl+") translate("+(l_m.h-s_m.h)+"px, "+(l_m.v-s_m.v)+"px)";
					r.className='rad_svg';
		}else{
			chars.appendChild(r);	
			r.className='rad';
		}	
					r.title=d.getAttribute("Hex");
					
				});
					
				chars.innerHTML+='<br>';
				
				let c=ch_comp2.filter((h)=>{
					let fnd=true;
					for(let k=0; len_k=incl.length, k<len_k; k++){
						if(!h.includes(incl[k])){
							fnd=false;
							k=len_k-1;
						}
					}
					return fnd;
				});
				
				fond=c;
fond_i=0;
wInterval = setInterval(writeFound,0);
				chars.scrollIntoView();
}

function clearAll(){
stopWriteFound();
	chars.innerHTML='';
	let rd=[...cmp.querySelectorAll('a.rad')];	
	if(rd.length>0){
		rd.forEach((d)=>{
			d.className='';
		});
	}
}

clr.onclick=()=>{
	clearAll();
}

chars.onclick=(e)=>{
var trg=null;
	if(e.target.tagName=="div" || e.target.tagName=="svg" || e.target.tagName=="g" || e.target.tagName=="path") {
				trg=e.target;
				while ((trg.tagName!="BLOCKQUOTE" && !(trg.className=="rad" || trg.className=="rad_svg") ) && trg.tagName!="HTML"){
					trg=trg.parentElement;
				}
		}else if(e.target.tagName=="BLOCKQUOTE" && (e.target.className=="rad" || e.target.className=="rad_svg") ){
				trg=e.target;
		}
		
	if(!!trg){
		let rd=[...cmp.querySelectorAll('a.rad'), ...cmp.querySelectorAll('a.rad_svg')];
		let k=rd.filter((l)=>{return trg.title==l.getAttribute("Hex");});
		if(k.length>0){
			k[0].scrollIntoView();
		}		
	}
}

slc.oninput=()=>{
	clearAll();
	drawCmp();
}
drawCmp();
</script>
</body>

</html>