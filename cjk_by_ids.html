<html>

<head>
<meta charset="UTF-8">
<script src="cjk_by_ids.js"></script>
<style>
section#txt {
    display: -webkit-inline-box;
}
section#components{
font-family: SimSun;
width: 50%;
}
section#chars {
    font-family: SimSun;
    width: 49%;
    margin-left: 1%;
}
section#chars > blockquote , a{
margin-block-start: 3px;
    margin-block-end: 4px;
    margin-inline-start: 5px;
    margin-inline-end: 0;
    background: white;
    width: max-content;
    display: inline-flex;
    font-size: 4ch;
}

section#chars > blockquote.rad, section#components > a.rad{
    background: red !important;
}
h1{
text-align: center;
}
</style>
<title>CJK By IDS</title>
</head>
	
<body>
<h1>CJK By IDS</h1>
<select id="order" style="background-color: buttonface;" title="Sort by"></select>
<button id="clear_er" style="background-color: buttonface;">Clear all selections</button>
<section id="txt"><br>
<section id="components" style="background-color: buttonface;"></section>
<section id="chars" style="background-color: buttonface;"></section>
</section>
<br>
<script>
let srt=["Sort by frequency", "Sort by stroke count"];
var slc=document.getElementById("order");
var cmp=document.getElementById("components");
var chs=document.getElementById("chars");
var clr=document.getElementById("clear_er");
var fond=[];
var fond_i=0;
var wInterval;

function writeFound() {
	try{
		chars.innerHTML+='<blockquote title="'+fond[fond_i][0]+'">'+fond[fond_i][1]+'</blockquote>';
		fond_i++;
	}catch(e){;}

}
function stopWriteFound() {
	clearInterval(wInterval);
	fond=[];
	fond_i=0;
}

srt.forEach(s => {
    let option = document.createElement('option');
    option.textContent = s;
    slc.appendChild(option);	
});

function drawCmp(){
let arr=(slc.selectedIndex==0)?smp_components_byFreq:smp_components_bySc;
cmp.innerHTML='';
for(let i=0; len_i=arr.length, i<len_i; i++){
		let lk=document.createElement('a');
		lk.setAttribute("Hex",arr[i][0]);
		lk.title=arr[i][0]+' (Stroke count: '+arr[i][3]+')';
		let ud=svgs.filter((s)=>{return s[0]==arr[i][0];});
		lk.innerHTML=String.fromCodePoint(arr[i][0]);
		if(ud.length>0){
		cmp.appendChild(lk);
		let lrct=lk.getBoundingClientRect();
		let w=lrct.width;
		let h=lrct.width;
		let b=lrct.bottom;
				lk.innerHTML='<svg><g><path style=" transform: scale(0.015); transform-origin: left center"; d="'+ud[0][1]+ '"/></g></svg>';
				let v=[...lk.children][0];
				v.style.width=w;
				v.style.height=h;
				lrct=lk.getBoundingClientRect();
				lk.style.transform="translateY("+(b-lrct.bottom)+"px)"
				v.style.transform="scaleY(-1)";
				v.style.transformOrigin="center";
				//let lrct2=lk.getBoundingClientRect();
		}else{
			cmp.appendChild(lk);
		}
		

	}
	
	let lnk=[...cmp.getElementsByTagName('a')];
	lnk.forEach((lk)=>{
			lk.onclick=()=>{
			stopWriteFound();
			if(lk.className==='rad'){
				lk.className='';
			}else{
				lk.className='rad';
			}
			let rd=[...cmp.querySelectorAll('a.rad')];
			
			chars.innerHTML='';
			if(rd.length>0){
				drawChars(rd);
			}
		};
});
}

function drawChars(rd){
				var incl=[];
				rd.forEach((d)=>{
					
					let r=document.createElement('blockquote');
					
		let t=String.fromCodePoint(d.getAttribute("Hex"));			
		let ud=svgs.filter((s)=>{return s[0]==d.getAttribute("Hex");});
		
					incl.push(t);
					r.innerHTML=t;
		if(ud.length>0){
		chars.appendChild(r);
		let lrct=r.getBoundingClientRect();
		let w=lrct.width;
		let h=lrct.width;
				r.innerHTML='<svg><g><path style=" transform: scale(0.015); transform-origin: left center"; d="'+ud[0][1]+ '"/></g></svg>';
				let v=[...r.children][0];
				v.style.width=w;
				v.style.height=h;
				v.style.transform="scaleY(-1)";
				v.style.transformOrigin="center";
				//let lrct2=lk.getBoundingClientRect();
		}else{
			chars.appendChild(r);

		}

					r.className='rad';
					r.title=d.getAttribute("Hex");
					
				});
					
				chars.innerHTML+='<br>';
				
				let c=ch_comp2.filter((h)=>{
					let fnd=true;
					for(let k=0; len_k=incl.length, k<len_k; k++){
						if(!h.includes(incl[k])){
							fnd=false;
							k=len_k-1;
						}
					}
					return fnd;
				});
				
				fond=c;
fond_i=0;
wInterval = setInterval(writeFound,0);
				chars.scrollIntoView();
}

function clearAll(){
stopWriteFound();
	chars.innerHTML='';
	let rd=[...cmp.querySelectorAll('a.rad')];	
	if(rd.length>0){
		rd.forEach((d)=>{
			d.className='';
		});
	}
}

clr.onclick=()=>{
	clearAll();
}

chars.onclick=(e)=>{
var trg=null;
	if((e.target.tagName=="svg" || e.target.tagName=="g" || e.target.tagName=="path") && e.target.parentElement.className=="rad") {
				trg=e.target;
				while (trg.tagName!="BLOCKQUOTE" && trg.tagName!="HTML"){
					trg=e.target.parentElement;
				}
		}else if( (e.target.tagName=="BLOCKQUOTE" && e.target.className=="rad") ){
				trg=e.target;
		}
		
	if(!!trg){
		let rd=[...cmp.querySelectorAll('a.rad')];
		let k=rd.filter((l)=>{return trg.title==l.getAttribute("Hex");});
		if(k.length>0){
			k[0].scrollIntoView();
		}		
	}
}

slc.oninput=()=>{
	clearAll();
	drawCmp();
}
drawCmp();
</script>
</body>

</html>